# プロンプトパターン集

## 構造化パターン

### XMLタグによる分離

Claudeはタグ構造を強く認識する。指示・データ・出力形式を明確に分離。

```markdown
<task>
ユーザーのフィードバックを分析して改善提案をまとめる
</task>

<data>
{{フィードバックデータ}}
</data>

<output_format>
## 主要な課題
1. [課題1]
2. [課題2]

## 改善提案
- 提案A: [内容]
- 提案B: [内容]
</output_format>
```

### 推奨タグ名

| タグ | 用途 |
|-----|------|
| `<task>` | 実行すべきタスク |
| `<context>` | 背景情報 |
| `<data>`, `<input>` | 処理対象データ |
| `<constraints>` | 制約条件 |
| `<output_format>` | 出力形式の指定 |
| `<example>` | 入出力例 |
| `<thinking>` | 思考過程の出力指示 |

## 具体性パターン

### Before/After比較

**Bad: 曖昧**
```markdown
コードを改善してください
```

**Good: 具体的**
```markdown
以下の観点でコードを改善:
1. 重複コードの関数化
2. マジックナンバーの定数化
3. エラーハンドリングの追加
変更箇所ごとにコメントで理由を説明すること。
```

### 数値・範囲の明示

**Bad**
```markdown
簡潔に説明してください
```

**Good**
```markdown
3文以内で説明。技術用語は避け、中学生でも理解できるレベルで。
```

### 禁止事項の明示

**Bad**
```markdown
テストを書いてください
```

**Good**
```markdown
テストを書く。
- mockは使用禁止（実際のDB接続を使用）
- 外部APIは専用のtest用エンドポイントを使用
- カバレッジ80%以上を目標
```

## ワークフローパターン

### 段階的実行

複雑なタスクは段階に分割。各段階で確認を挟む。

```markdown
以下の段階でリファクタリングを実行:

## Phase 1: 分析（コード変更なし）
- 現在のアーキテクチャを図示
- 問題点をリストアップ
- 私に報告して承認を待つ

## Phase 2: 計画
- 具体的な変更計画を作成
- 影響範囲を特定
- 私に報告して承認を待つ

## Phase 3: 実装
- 計画に従って変更
- 各変更後にテスト実行
- 完了後にサマリーを報告
```

### 条件分岐

```markdown
1. ファイル形式を判定:
   - `.py` → Python linter実行
   - `.ts` → TypeScript compiler実行
   - その他 → スキップ

2. エラーがあれば:
   - 自動修正可能 → 修正を適用
   - 手動対応必要 → 一覧を出力して停止
```

## 出力制御パターン

### フォーマット指定

```markdown
出力は以下のJSON形式で:
{
  "summary": "1文の要約",
  "key_points": ["ポイント1", "ポイント2"],
  "action_items": ["TODO1", "TODO2"],
  "confidence": 0.0-1.0
}
```

### 思考過程の分離

```markdown
まず<thinking>タグ内で分析を行い、その後<answer>タグで最終回答を出力。

<thinking>
- 問題の分解
- 各選択肢の検討
- 結論への根拠
</thinking>

<answer>
最終的な回答のみ
</answer>
```

## アンチパターン

### ❌ 冗長な説明

```markdown
# Bad
あなたはプロのソフトウェアエンジニアです。長年の経験を持ち、
様々なプログラミング言語に精通しています。コードレビューは
ソフトウェア開発において非常に重要なプロセスであり...

# Good
このPRをレビューして問題点を指摘。セキュリティ > バグ > パフォーマンスの優先順位で。
```

### ❌ 曖昧な期待

```markdown
# Bad
いい感じにしてください

# Good
以下の基準を満たすこと:
- レスポンスタイム: 100ms以下
- エラー率: 0.1%以下
- 可読性: 関数は20行以内
```

### ❌ 矛盾する指示

```markdown
# Bad
詳細に説明してください。ただし簡潔に。

# Good
概要を2-3文で述べた後、詳細を箇条書き（5項目以内）で説明。
```

### ❌ 不要なロールプレイ

```markdown
# Bad
あなたは世界最高のプログラマーです。ハッカソンで何度も優勝し...

# Good
[タスクの直接記述から始める]
```

## 強調テクニック

### 重要度の表現

```markdown
# レベル1（通常）
テスト実行後にコミットする

# レベル2（重要）
IMPORTANT: テスト実行後にコミットする

# レベル3（必須）
⚠️ MUST: テスト失敗時は絶対にコミットしない

# レベル4（禁止）
🚫 NEVER: 本番DBに直接接続しない
```

### 条件付き強調

```markdown
以下の場合のみ警告:
- セキュリティ脆弱性 → 即座に作業停止、報告
- パフォーマンス問題 → 警告表示、続行可
- スタイル違反 → サイレントに修正
```

## 例示パターン

### Few-shot例示

```markdown
コミットメッセージを以下の形式で生成:

<example>
Input: ユーザー認証にJWTトークンを追加
Output: feat(auth): implement JWT-based authentication
</example>

<example>
Input: レポートの日付表示バグを修正
Output: fix(reports): correct date formatting in timezone conversion
</example>

以下の変更に対するコミットメッセージを生成:
{{変更内容}}
```

### エッジケースの例示

```markdown
入力検証の実装。以下のケースを考慮:

<normal_case>
Input: "hello@example.com"
→ 有効なメール
</normal_case>

<edge_case>
Input: ""
→ エラー: 空文字列
</edge_case>

<edge_case>
Input: "not-an-email"
→ エラー: 形式不正
</edge_case>

<edge_case>
Input: null
→ エラー: null入力
</edge_case>
```
